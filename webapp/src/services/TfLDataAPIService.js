/* eslint-env browser */
/* eslint-disable class-methods-use-this */

import ArrivalTime from './ArrivalTime';

class TfLDataAPIService {
    fetchArrivals(stationId, directionId, lines) {
        const url = this._buildUrl(stationId, directionId, lines);
        return fetch(url)
            .then(resp => resp.json())
            .then(json => this._parseData(json));
    }

    _buildUrl(stationId, directionId, lines) {
        const linesStr = lines.join('%2C', lines);
        return `https://api.tfl.gov.uk/Line/${linesStr}/Arrivals/${stationId}?direction=${directionId}`;
    }

    _parseData(json) {
        return json.map((arrival) => {
            const lineName = arrival.lineName;
            const destinationName = arrival.destinationName;
            const expectedIn = arrival.timeToStation;
            return new ArrivalTime(lineName, destinationName, expectedIn);
        }).sort((a, b) => a.expectedSeconds - b.expectedSeconds);
    }

    // fetchArrivals() {
    //             const json = 
    //         [{"$type":"Tfl.Api.Presentation.Entities.Prediction, Tfl.Api.Presentation.Entities","id":"1152176492","operationType":1,"vehicleId":"011","naptanId":"940GZZLUTBY","stationName":"Tooting Broadway Underground Station","lineId":"northern","lineName":"Northern","platformName":"Southbound - Platform 2","direction":"inbound","bearing":"","destinationNaptanId":"940GZZLUMDN","destinationName":"Morden Underground Station","timestamp":"2017-10-09T08:04:43Z","timeToStation":45,"currentLocation":"Between Tooting Bec and Tooting Broadway","towards":"Morden via Bank","expectedArrival":"2017-10-09T08:05:28Z","timeToLive":"2017-10-09T08:05:28Z","modeName":"tube","timing":{"$type":"Tfl.Api.Presentation.Entities.PredictionTiming, Tfl.Api.Presentation.Entities","countdownServerAdjustment":"00:00:00","source":"0001-01-01T00:00:00","insert":"0001-01-01T00:00:00","read":"2017-10-09T08:04:36.307Z","sent":"2017-10-09T08:04:43Z","received":"0001-01-01T00:00:00"}},{"$type":"Tfl.Api.Presentation.Entities.Prediction, Tfl.Api.Presentation.Entities","id":"-506176823","operationType":1,"vehicleId":"012","naptanId":"940GZZLUTBY","stationName":"Tooting Broadway Underground Station","lineId":"northern","lineName":"Northern","platformName":"Southbound - Platform 2","direction":"inbound","bearing":"","destinationNaptanId":"940GZZLUMDN","destinationName":"Morden Underground Station","timestamp":"2017-10-09T08:04:43Z","timeToStation":705,"currentLocation":"At Stockwell Platform 3","towards":"Morden via Bank","expectedArrival":"2017-10-09T08:16:28Z","timeToLive":"2017-10-09T08:16:28Z","modeName":"tube","timing":{"$type":"Tfl.Api.Presentation.Entities.PredictionTiming, Tfl.Api.Presentation.Entities","countdownServerAdjustment":"00:00:00","source":"0001-01-01T00:00:00","insert":"0001-01-01T00:00:00","read":"2017-10-09T08:04:36.338Z","sent":"2017-10-09T08:04:43Z","received":"0001-01-01T00:00:00"}},{"$type":"Tfl.Api.Presentation.Entities.Prediction, Tfl.Api.Presentation.Entities","id":"-2105692590","operationType":1,"vehicleId":"013","naptanId":"940GZZLUTBY","stationName":"Tooting Broadway Underground Station","lineId":"northern","lineName":"Northern","platformName":"Southbound - Platform 2","direction":"inbound","bearing":"","destinationNaptanId":"940GZZLUMDN","destinationName":"Morden Underground Station","timestamp":"2017-10-09T08:04:43Z","timeToStation":1185,"currentLocation":"Between Borough and Elephant and Castle ","towards":"Morden via Bank","expectedArrival":"2017-10-09T08:24:28Z","timeToLive":"2017-10-09T08:24:28Z","modeName":"tube","timing":{"$type":"Tfl.Api.Presentation.Entities.PredictionTiming, Tfl.Api.Presentation.Entities","countdownServerAdjustment":"00:00:00","source":"0001-01-01T00:00:00","insert":"0001-01-01T00:00:00","read":"2017-10-09T08:04:36.354Z","sent":"2017-10-09T08:04:43Z","received":"0001-01-01T00:00:00"}},{"$type":"Tfl.Api.Presentation.Entities.Prediction, Tfl.Api.Presentation.Entities","id":"1554330431","operationType":1,"vehicleId":"014","naptanId":"940GZZLUTBY","stationName":"Tooting Broadway Underground Station","lineId":"northern","lineName":"Northern","platformName":"Southbound - Platform 2","direction":"inbound","bearing":"","destinationNaptanId":"940GZZLUMDN","destinationName":"Morden Underground Station","timestamp":"2017-10-09T08:04:43Z","timeToStation":1485,"currentLocation":"At Bank Platform 3","towards":"Morden via Bank","expectedArrival":"2017-10-09T08:29:28Z","timeToLive":"2017-10-09T08:29:28Z","modeName":"tube","timing":{"$type":"Tfl.Api.Presentation.Entities.PredictionTiming, Tfl.Api.Presentation.Entities","countdownServerAdjustment":"00:00:00","source":"0001-01-01T00:00:00","insert":"0001-01-01T00:00:00","read":"2017-10-09T08:04:36.369Z","sent":"2017-10-09T08:04:43Z","received":"0001-01-01T00:00:00"}},{"$type":"Tfl.Api.Presentation.Entities.Prediction, Tfl.Api.Presentation.Entities","id":"-104692584","operationType":1,"vehicleId":"015","naptanId":"940GZZLUTBY","stationName":"Tooting Broadway Underground Station","lineId":"northern","lineName":"Northern","platformName":"Southbound - Platform 2","direction":"inbound","bearing":"","destinationNaptanId":"940GZZLUMDN","destinationName":"Morden Underground Station","timestamp":"2017-10-09T08:04:43Z","timeToStation":1605,"currentLocation":"At Old Street Platform 2","towards":"Morden via Bank","expectedArrival":"2017-10-09T08:31:28Z","timeToLive":"2017-10-09T08:31:28Z","modeName":"tube","timing":{"$type":"Tfl.Api.Presentation.Entities.PredictionTiming, Tfl.Api.Presentation.Entities","countdownServerAdjustment":"00:00:00","source":"0001-01-01T00:00:00","insert":"0001-01-01T00:00:00","read":"2017-10-09T08:04:36.385Z","sent":"2017-10-09T08:04:43Z","received":"0001-01-01T00:00:00"}},{"$type":"Tfl.Api.Presentation.Entities.Prediction, Tfl.Api.Presentation.Entities","id":"1151586668","operationType":1,"vehicleId":"041","naptanId":"940GZZLUTBY","stationName":"Tooting Broadway Underground Station","lineId":"northern","lineName":"Northern","platformName":"Southbound - Platform 2","direction":"inbound","bearing":"","destinationNaptanId":"940GZZLUMDN","destinationName":"Morden Underground Station","timestamp":"2017-10-09T08:04:43Z","timeToStation":825,"currentLocation":"Between Oval and Stockwell","towards":"Morden via Bank","expectedArrival":"2017-10-09T08:18:28Z","timeToLive":"2017-10-09T08:18:28Z","modeName":"tube","timing":{"$type":"Tfl.Api.Presentation.Entities.PredictionTiming, Tfl.Api.Presentation.Entities","countdownServerAdjustment":"00:00:00","source":"0001-01-01T00:00:00","insert":"0001-01-01T00:00:00","read":"2017-10-09T08:04:36.338Z","sent":"2017-10-09T08:04:43Z","received":"0001-01-01T00:00:00"}},{"$type":"Tfl.Api.Presentation.Entities.Prediction, Tfl.Api.Presentation.Entities","id":"-506766647","operationType":1,"vehicleId":"042","naptanId":"940GZZLUTBY","stationName":"Tooting Broadway Underground Station","lineId":"northern","lineName":"Northern","platformName":"Southbound - Platform 2","direction":"inbound","bearing":"","destinationNaptanId":"940GZZLUMDN","destinationName":"Morden Underground Station","timestamp":"2017-10-09T08:04:43Z","timeToStation":1005,"currentLocation":"At Kennington Platform 2","towards":"Morden via CX","expectedArrival":"2017-10-09T08:21:28Z","timeToLive":"2017-10-09T08:21:28Z","modeName":"tube","timing":{"$type":"Tfl.Api.Presentation.Entities.PredictionTiming, Tfl.Api.Presentation.Entities","countdownServerAdjustment":"00:00:00","source":"0001-01-01T00:00:00","insert":"0001-01-01T00:00:00","read":"2017-10-09T08:04:36.354Z","sent":"2017-10-09T08:04:43Z","received":"0001-01-01T00:00:00"}},{"$type":"Tfl.Api.Presentation.Entities.Prediction, Tfl.Api.Presentation.Entities","id":"-2106544558","operationType":1,"vehicleId":"043","naptanId":"940GZZLUTBY","stationName":"Tooting Broadway Underground Station","lineId":"northern","lineName":"Northern","platformName":"Southbound - Platform 2","direction":"inbound","bearing":"","destinationNaptanId":"940GZZLUMDN","destinationName":"Morden Underground Station","timestamp":"2017-10-09T08:04:43Z","timeToStation":1605,"currentLocation":"Between Goodge Street and Tottenham Court Road","towards":"Morden via CX","expectedArrival":"2017-10-09T08:31:28Z","timeToLive":"2017-10-09T08:31:28Z","modeName":"tube","timing":{"$type":"Tfl.Api.Presentation.Entities.PredictionTiming, Tfl.Api.Presentation.Entities","countdownServerAdjustment":"00:00:00","source":"0001-01-01T00:00:00","insert":"0001-01-01T00:00:00","read":"2017-10-09T08:04:36.385Z","sent":"2017-10-09T08:04:43Z","received":"0001-01-01T00:00:00"}},{"$type":"Tfl.Api.Presentation.Entities.Prediction, Tfl.Api.Presentation.Entities","id":"1553478463","operationType":1,"vehicleId":"044","naptanId":"940GZZLUTBY","stationName":"Tooting Broadway Underground Station","lineId":"northern","lineName":"Northern","platformName":"Southbound - Platform 2","direction":"inbound","bearing":"","destinationNaptanId":"940GZZLUMDN","destinationName":"Morden Underground Station","timestamp":"2017-10-09T08:04:43Z","timeToStation":1725,"currentLocation":"Between Angel and Old Street","towards":"Morden via Bank","expectedArrival":"2017-10-09T08:33:28Z","timeToLive":"2017-10-09T08:33:28Z","modeName":"tube","timing":{"$type":"Tfl.Api.Presentation.Entities.PredictionTiming, Tfl.Api.Presentation.Entities","countdownServerAdjustment":"00:00:00","source":"0001-01-01T00:00:00","insert":"0001-01-01T00:00:00","read":"2017-10-09T08:04:36.401Z","sent":"2017-10-09T08:04:43Z","received":"0001-01-01T00:00:00"}},{"$type":"Tfl.Api.Presentation.Entities.Prediction, Tfl.Api.Presentation.Entities","id":"882351566","operationType":1,"vehicleId":"057","naptanId":"940GZZLUTBY","stationName":"Tooting Broadway Underground Station","lineId":"northern","lineName":"Northern","platformName":"Southbound - Platform 2","direction":"inbound","bearing":"","destinationNaptanId":"940GZZLUMDN","destinationName":"Morden Underground Station","timestamp":"2017-10-09T08:04:43Z","timeToStation":225,"currentLocation":"At Balham Platform 2","towards":"Morden via Bank","expectedArrival":"2017-10-09T08:08:28Z","timeToLive":"2017-10-09T08:08:28Z","modeName":"tube","timing":{"$type":"Tfl.Api.Presentation.Entities.PredictionTiming, Tfl.Api.Presentation.Entities","countdownServerAdjustment":"00:00:00","source":"0001-01-01T00:00:00","insert":"0001-01-01T00:00:00","read":"2017-10-09T08:04:36.307Z","sent":"2017-10-09T08:04:43Z","received":"0001-01-01T00:00:00"}},{"$type":"Tfl.Api.Presentation.Entities.Prediction, Tfl.Api.Presentation.Entities","id":"1553871679","operationType":1,"vehicleId":"064","naptanId":"940GZZLUTBY","stationName":"Tooting Broadway Underground Station","lineId":"northern","lineName":"Northern","platformName":"Southbound - Platform 2","direction":"inbound","bearing":"","destinationNaptanId":"940GZZLUMDN","destinationName":"Morden Underground Station","timestamp":"2017-10-09T08:04:43Z","timeToStation":585,"currentLocation":"Between Clapham North and Clapham Common","towards":"Morden via Bank","expectedArrival":"2017-10-09T08:14:28Z","timeToLive":"2017-10-09T08:14:28Z","modeName":"tube","timing":{"$type":"Tfl.Api.Presentation.Entities.PredictionTiming, Tfl.Api.Presentation.Entities","countdownServerAdjustment":"00:00:00","source":"0001-01-01T00:00:00","insert":"0001-01-01T00:00:00","read":"2017-10-09T08:04:36.322Z","sent":"2017-10-09T08:04:43Z","received":"0001-01-01T00:00:00"}},{"$type":"Tfl.Api.Presentation.Entities.Prediction, Tfl.Api.Presentation.Entities","id":"-104364904","operationType":1,"vehicleId":"065","naptanId":"940GZZLUTBY","stationName":"Tooting Broadway Underground Station","lineId":"northern","lineName":"Northern","platformName":"Southbound - Platform 2","direction":"inbound","bearing":"","destinationNaptanId":"940GZZLUMDN","destinationName":"Morden Underground Station","timestamp":"2017-10-09T08:04:43Z","timeToStation":1185,"currentLocation":"At Borough Platform 2","towards":"Morden via Bank","expectedArrival":"2017-10-09T08:24:28Z","timeToLive":"2017-10-09T08:24:28Z","modeName":"tube","timing":{"$type":"Tfl.Api.Presentation.Entities.PredictionTiming, Tfl.Api.Presentation.Entities","countdownServerAdjustment":"00:00:00","source":"0001-01-01T00:00:00","insert":"0001-01-01T00:00:00","read":"2017-10-09T08:04:36.369Z","sent":"2017-10-09T08:04:43Z","received":"0001-01-01T00:00:00"}},{"$type":"Tfl.Api.Presentation.Entities.Prediction, Tfl.Api.Presentation.Entities","id":"1151455597","operationType":1,"vehicleId":"161","naptanId":"940GZZLUTBY","stationName":"Tooting Broadway Underground Station","lineId":"northern","lineName":"Northern","platformName":"Southbound - Platform 2","direction":"inbound","bearing":"","destinationNaptanId":"940GZZLUMDN","destinationName":"Morden Underground Station","timestamp":"2017-10-09T08:04:43Z","timeToStation":465,"currentLocation":"Departed Clapham Common","towards":"Morden via CX","expectedArrival":"2017-10-09T08:12:28Z","timeToLive":"2017-10-09T08:12:28Z","modeName":"tube","timing":{"$type":"Tfl.Api.Presentation.Entities.PredictionTiming, Tfl.Api.Presentation.Entities","countdownServerAdjustment":"00:00:00","source":"0001-01-01T00:00:00","insert":"0001-01-01T00:00:00","read":"2017-10-09T08:04:36.322Z","sent":"2017-10-09T08:04:43Z","received":"0001-01-01T00:00:00"}},{"$type":"Tfl.Api.Presentation.Entities.Prediction, Tfl.Api.Presentation.Entities","id":"-506897674","operationType":1,"vehicleId":"162","naptanId":"940GZZLUTBY","stationName":"Tooting Broadway Underground Station","lineId":"northern","lineName":"Northern","platformName":"Southbound - Platform 2","direction":"inbound","bearing":"","destinationNaptanId":"940GZZLUMDN","destinationName":"Morden Underground Station","timestamp":"2017-10-09T08:04:43Z","timeToStation":945,"currentLocation":"At Kennington Platform 4","towards":"Morden via Bank","expectedArrival":"2017-10-09T08:20:28Z","timeToLive":"2017-10-09T08:20:28Z","modeName":"tube","timing":{"$type":"Tfl.Api.Presentation.Entities.PredictionTiming, Tfl.Api.Presentation.Entities","countdownServerAdjustment":"00:00:00","source":"0001-01-01T00:00:00","insert":"0001-01-01T00:00:00","read":"2017-10-09T08:04:36.338Z","sent":"2017-10-09T08:04:43Z","received":"0001-01-01T00:00:00"}},{"$type":"Tfl.Api.Presentation.Entities.Prediction, Tfl.Api.Presentation.Entities","id":"-2106151341","operationType":1,"vehicleId":"163","naptanId":"940GZZLUTBY","stationName":"Tooting Broadway Underground Station","lineId":"northern","lineName":"Northern","platformName":"Southbound - Platform 2","direction":"inbound","bearing":"","destinationNaptanId":"940GZZLUMDN","destinationName":"Morden Underground Station","timestamp":"2017-10-09T08:04:43Z","timeToStation":1305,"currentLocation":"At London Bridge Platform 2","towards":"Morden via Bank","expectedArrival":"2017-10-09T08:26:28Z","timeToLive":"2017-10-09T08:26:28Z","modeName":"tube","timing":{"$type":"Tfl.Api.Presentation.Entities.PredictionTiming, Tfl.Api.Presentation.Entities","countdownServerAdjustment":"00:00:00","source":"0001-01-01T00:00:00","insert":"0001-01-01T00:00:00","read":"2017-10-09T08:04:36.369Z","sent":"2017-10-09T08:04:43Z","received":"0001-01-01T00:00:00"}}]
            
    //         const parsed = this._parseData(json);
    //         return Promise.resolve(parsed);
    // }
}
/* eslint-enable class-methods-use-this */

export default TfLDataAPIService;
